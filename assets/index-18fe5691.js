import{aQ as u,ac as js,r as b,t as at,k as ks,m as Ts,j as a,d as z,L as Le,e as ct,b as He,c as J,F as Is,T as Os,P as $s}from"./index-3a462e11.js";import{S as dn}from"./index-d63f82a7.js";import{u as Rs}from"./avatar-1-34f0c02a.js";import{D as T}from"./Dropdown-0297e4c2.js";import{B as As}from"./Button-c7c76d56.js";import"./import-beaed125.js";import"./useCallbackRef-aedf03a1.js";import"./mergeOptionsWithPopperConfig-67b37497.js";import"./InputGroupContext-5be72602.js";var fn={exports:{}},lt={};u.crypto&&u.crypto.getRandomValues?lt.randomBytes=function(t){var e=new Uint8Array(t);return u.crypto.getRandomValues(e),e}:lt.randomBytes=function(t){for(var e=new Array(t),n=0;n<t;n++)e[n]=Math.floor(Math.random()*256);return e};var Us=lt,Ht="abcdefghijklmnopqrstuvwxyz012345",se={string:function(t){for(var e=Ht.length,n=Us.randomBytes(t),s=[],r=0;r<t;r++)s.push(Ht.substr(n[r]%e,1));return s.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var e=(""+(t-1)).length,n=new Array(e+1).join("0");return(n+this.number(t)).slice(-e)}};(function(t){var e=se,n={},s=!1,r=u.chrome&&u.chrome.app&&u.chrome.app.runtime;t.exports={attachEvent:function(o,c){typeof u.addEventListener<"u"?u.addEventListener(o,c,!1):u.document&&u.attachEvent&&(u.document.attachEvent("on"+o,c),u.attachEvent("on"+o,c))},detachEvent:function(o,c){typeof u.addEventListener<"u"?u.removeEventListener(o,c,!1):u.document&&u.detachEvent&&(u.document.detachEvent("on"+o,c),u.detachEvent("on"+o,c))},unloadAdd:function(o){if(r)return null;var c=e.string(8);return n[c]=o,s&&setTimeout(this.triggerUnloadCallbacks,0),c},unloadDel:function(o){o in n&&delete n[o]},triggerUnloadCallbacks:function(){for(var o in n)n[o](),delete n[o]}};var i=function(){s||(s=!0,t.exports.triggerUnloadCallbacks())};r||t.exports.attachEvent("unload",i)})(fn);var q=fn.exports,Ls=function(e,n){if(n=n.split(":")[0],e=+e,!e)return!1;switch(n){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},xt={},Hs=Object.prototype.hasOwnProperty,Bs;function Bt(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch{return null}}function Wt(t){try{return encodeURIComponent(t)}catch{return null}}function Ws(t){for(var e=/([^=?#&]+)=?([^&]*)/g,n={},s;s=e.exec(t);){var r=Bt(s[1]),i=Bt(s[2]);r===null||i===null||r in n||(n[r]=i)}return n}function Ps(t,e){e=e||"";var n=[],s,r;typeof e!="string"&&(e="?");for(r in t)if(Hs.call(t,r)){if(s=t[r],!s&&(s===null||s===Bs||isNaN(s))&&(s=""),r=Wt(r),s=Wt(s),r===null||s===null)continue;n.push(r+"="+s)}return n.length?e+n.join("&"):""}xt.stringify=Ps;xt.parse=Ws;var pn=Ls,We=xt,Ms=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,mn=/[\n\r\t]/g,Ds=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,gn=/:\d+$/,Fs=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Vs=/^[a-zA-Z]:/;function Et(t){return(t||"").toString().replace(Ms,"")}var ht=[["#","hash"],["?","query"],function(e,n){return R(n.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],Pt={hash:1,query:1};function bn(t){var e;typeof window<"u"?e=window:typeof u<"u"?e=u:typeof self<"u"?e=self:e={};var n=e.location||{};t=t||n;var s={},r=typeof t,i;if(t.protocol==="blob:")s=new U(unescape(t.pathname),{});else if(r==="string"){s=new U(t,{});for(i in Pt)delete s[i]}else if(r==="object"){for(i in t)i in Pt||(s[i]=t[i]);s.slashes===void 0&&(s.slashes=Ds.test(t.href))}return s}function R(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function vn(t,e){t=Et(t),t=t.replace(mn,""),e=e||{};var n=Fs.exec(t),s=n[1]?n[1].toLowerCase():"",r=!!n[2],i=!!n[3],o=0,c;return r?i?(c=n[2]+n[3]+n[4],o=n[2].length+n[3].length):(c=n[2]+n[4],o=n[2].length):i?(c=n[3]+n[4],o=n[3].length):c=n[4],s==="file:"?o>=2&&(c=c.slice(2)):R(s)?c=n[4]:s?r&&(c=c.slice(2)):o>=2&&R(e.protocol)&&(c=n[4]),{protocol:s,slashes:r||R(s),slashesCount:o,rest:c}}function qs(t,e){if(t==="")return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),s=n.length,r=n[s-1],i=!1,o=0;s--;)n[s]==="."?n.splice(s,1):n[s]===".."?(n.splice(s,1),o++):o&&(s===0&&(i=!0),n.splice(s,1),o--);return i&&n.unshift(""),(r==="."||r==="..")&&n.push(""),n.join("/")}function U(t,e,n){if(t=Et(t),t=t.replace(mn,""),!(this instanceof U))return new U(t,e,n);var s,r,i,o,c,h,d=ht.slice(),f=typeof e,l=this,g=0;for(f!=="object"&&f!=="string"&&(n=e,e=null),n&&typeof n!="function"&&(n=We.parse),e=bn(e),r=vn(t||"",e),s=!r.protocol&&!r.slashes,l.slashes=r.slashes||s&&e.slashes,l.protocol=r.protocol||e.protocol||"",t=r.rest,(r.protocol==="file:"&&(r.slashesCount!==2||Vs.test(t))||!r.slashes&&(r.protocol||r.slashesCount<2||!R(l.protocol)))&&(d[3]=[/(.*)/,"pathname"]);g<d.length;g++){if(o=d[g],typeof o=="function"){t=o(t,l);continue}i=o[0],h=o[1],i!==i?l[h]=t:typeof i=="string"?(c=i==="@"?t.lastIndexOf(i):t.indexOf(i),~c&&(typeof o[2]=="number"?(l[h]=t.slice(0,c),t=t.slice(c+o[2])):(l[h]=t.slice(c),t=t.slice(0,c)))):(c=i.exec(t))&&(l[h]=c[1],t=t.slice(0,c.index)),l[h]=l[h]||s&&o[3]&&e[h]||"",o[4]&&(l[h]=l[h].toLowerCase())}n&&(l.query=n(l.query)),s&&e.slashes&&l.pathname.charAt(0)!=="/"&&(l.pathname!==""||e.pathname!=="")&&(l.pathname=qs(l.pathname,e.pathname)),l.pathname.charAt(0)!=="/"&&R(l.protocol)&&(l.pathname="/"+l.pathname),pn(l.port,l.protocol)||(l.host=l.hostname,l.port=""),l.username=l.password="",l.auth&&(c=l.auth.indexOf(":"),~c?(l.username=l.auth.slice(0,c),l.username=encodeURIComponent(decodeURIComponent(l.username)),l.password=l.auth.slice(c+1),l.password=encodeURIComponent(decodeURIComponent(l.password))):l.username=encodeURIComponent(decodeURIComponent(l.auth)),l.auth=l.password?l.username+":"+l.password:l.username),l.origin=l.protocol!=="file:"&&R(l.protocol)&&l.host?l.protocol+"//"+l.host:"null",l.href=l.toString()}function Xs(t,e,n){var s=this;switch(t){case"query":typeof e=="string"&&e.length&&(e=(n||We.parse)(e)),s[t]=e;break;case"port":s[t]=e,pn(e,s.protocol)?e&&(s.host=s.hostname+":"+e):(s.host=s.hostname,s[t]="");break;case"hostname":s[t]=e,s.port&&(e+=":"+s.port),s.host=e;break;case"host":s[t]=e,gn.test(e)?(e=e.split(":"),s.port=e.pop(),s.hostname=e.join(":")):(s.hostname=e,s.port="");break;case"protocol":s.protocol=e.toLowerCase(),s.slashes=!n;break;case"pathname":case"hash":if(e){var r=t==="pathname"?"/":"#";s[t]=e.charAt(0)!==r?r+e:e}else s[t]=e;break;case"username":case"password":s[t]=encodeURIComponent(e);break;case"auth":var i=e.indexOf(":");~i?(s.username=e.slice(0,i),s.username=encodeURIComponent(decodeURIComponent(s.username)),s.password=e.slice(i+1),s.password=encodeURIComponent(decodeURIComponent(s.password))):s.username=encodeURIComponent(decodeURIComponent(e))}for(var o=0;o<ht.length;o++){var c=ht[o];c[4]&&(s[c[1]]=s[c[1]].toLowerCase())}return s.auth=s.password?s.username+":"+s.password:s.username,s.origin=s.protocol!=="file:"&&R(s.protocol)&&s.host?s.protocol+"//"+s.host:"null",s.href=s.toString(),s}function Gs(t){(!t||typeof t!="function")&&(t=We.stringify);var e,n=this,s=n.host,r=n.protocol;r&&r.charAt(r.length-1)!==":"&&(r+=":");var i=r+(n.protocol&&n.slashes||R(n.protocol)?"//":"");return n.username?(i+=n.username,n.password&&(i+=":"+n.password),i+="@"):n.password?(i+=":"+n.password,i+="@"):n.protocol!=="file:"&&R(n.protocol)&&!s&&n.pathname!=="/"&&(i+="@"),(s[s.length-1]===":"||gn.test(n.hostname)&&!n.port)&&(s+=":"),i+=s+n.pathname,e=typeof n.query=="object"?t(n.query):n.query,e&&(i+=e.charAt(0)!=="?"?"?"+e:e),n.hash&&(i+=n.hash),i}U.prototype={set:Xs,toString:Gs};U.extractProtocol=vn;U.location=bn;U.trimLeft=Et;U.qs=We;var yn=U,Js=yn,O={getOrigin:function(t){if(!t)return null;var e=new Js(t);if(e.protocol==="file:")return null;var n=e.port;return n||(n=e.protocol==="https:"?"443":"80"),e.protocol+"//"+e.hostname+":"+n},isOriginEqual:function(t,e){var n=this.getOrigin(t)===this.getOrigin(e);return n},isSchemeEqual:function(t,e){return t.split(":")[0]===e.split(":")[0]},addPath:function(t,e){var n=t.split("?");return n[0]+e+(n[1]?"?"+n[1]:"")},addQuery:function(t,e){return t+(t.indexOf("?")===-1?"?"+e:"&"+e)},isLoopbackAddr:function(t){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^\[::1\]$/.test(t)}},ut={exports:{}};typeof Object.create=="function"?ut.exports=function(e,n){n&&(e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:ut.exports=function(e,n){if(n){e.super_=n;var s=function(){};s.prototype=n.prototype,e.prototype=new s,e.prototype.constructor=e}};var m=ut.exports,_={};function Pe(){this._listeners={}}Pe.prototype.addEventListener=function(t,e){t in this._listeners||(this._listeners[t]=[]);var n=this._listeners[t];n.indexOf(e)===-1&&(n=n.concat([e])),this._listeners[t]=n};Pe.prototype.removeEventListener=function(t,e){var n=this._listeners[t];if(n){var s=n.indexOf(e);if(s!==-1){n.length>1?this._listeners[t]=n.slice(0,s).concat(n.slice(s+1)):delete this._listeners[t];return}}};Pe.prototype.dispatchEvent=function(){var t=arguments[0],e=t.type,n=arguments.length===1?[t]:Array.apply(null,arguments);if(this["on"+e]&&this["on"+e].apply(this,n),e in this._listeners)for(var s=this._listeners[e],r=0;r<s.length;r++)s[r].apply(this,n)};var _n=Pe,zs=m,Me=_n;function V(){Me.call(this)}zs(V,Me);V.prototype.removeAllListeners=function(t){t?delete this._listeners[t]:this._listeners={}};V.prototype.once=function(t,e){var n=this,s=!1;function r(){n.removeListener(t,r),s||(s=!0,e.apply(this,arguments))}this.on(t,r)};V.prototype.emit=function(){var t=arguments[0],e=this._listeners[t];if(e){for(var n=arguments.length,s=new Array(n-1),r=1;r<n;r++)s[r-1]=arguments[r];for(var i=0;i<e.length;i++)e[i].apply(this,s)}};V.prototype.on=V.prototype.addListener=Me.prototype.addEventListener;V.prototype.removeListener=Me.prototype.removeEventListener;_.EventEmitter=V;var dt={exports:{}},Mt=u.WebSocket||u.MozWebSocket;Mt?dt.exports=function(e){return new Mt(e)}:dt.exports=void 0;var Ks=dt.exports,wn=q,Qs=O,Zs=m,xn=_.EventEmitter,En=Ks,Dt=function(){};function P(t,e,n){if(!P.enabled())throw new Error("Transport created when disabled");xn.call(this);var s=this,r=Qs.addPath(t,"/websocket");r.slice(0,5)==="https"?r="wss"+r.slice(5):r="ws"+r.slice(4),this.url=r,this.ws=new En(this.url,[],n),this.ws.onmessage=function(i){Dt("message event",i.data),s.emit("message",i.data)},this.unloadRef=wn.unloadAdd(function(){s.ws.close()}),this.ws.onclose=function(i){Dt("close event",i.code,i.reason),s.emit("close",i.code,i.reason),s._cleanup()},this.ws.onerror=function(i){s.emit("close",1006,"WebSocket connection broken"),s._cleanup()}}Zs(P,xn);P.prototype.send=function(t){var e="["+t+"]";this.ws.send(e)};P.prototype.close=function(){var t=this.ws;this._cleanup(),t&&t.close()};P.prototype._cleanup=function(){var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),wn.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()};P.enabled=function(){return!!En};P.transportName="websocket";P.roundTrips=2;var Ys=P,er=m,Sn=_.EventEmitter,tr=function(){};function K(t,e){Sn.call(this),this.sendBuffer=[],this.sender=e,this.url=t}er(K,Sn);K.prototype.send=function(t){this.sendBuffer.push(t),this.sendStop||this.sendSchedule()};K.prototype.sendScheduleWait=function(){var t=this,e;this.sendStop=function(){t.sendStop=null,clearTimeout(e)},e=setTimeout(function(){t.sendStop=null,t.sendSchedule()},25)};K.prototype.sendSchedule=function(){tr("sendSchedule",this.sendBuffer.length);var t=this;if(this.sendBuffer.length>0){var e="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,e,function(n){t.sendStop=null,n?(t.emit("close",n.code||1006,"Sending error: "+n),t.close()):t.sendScheduleWait()}),this.sendBuffer=[]}};K.prototype._cleanup=function(){this.removeAllListeners()};K.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)};var nr=K,sr=m,Cn=_.EventEmitter,rr=function(){};function De(t,e,n){Cn.call(this),this.Receiver=t,this.receiveUrl=e,this.AjaxObject=n,this._scheduleReceiver()}sr(De,Cn);De.prototype._scheduleReceiver=function(){var t=this,e=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);e.on("message",function(n){t.emit("message",n)}),e.once("close",function(n,s){rr("close",n,s,t.pollIsClosing),t.poll=e=null,t.pollIsClosing||(s==="network"?t._scheduleReceiver():(t.emit("close",n||1006,s),t.removeAllListeners()))})};De.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()};var ir=De,or=m,ar=O,St=nr,cr=ir;function Ct(t,e,n,s,r){var i=ar.addPath(t,e),o=this;St.call(this,t,n),this.poll=new cr(s,i,r),this.poll.on("message",function(c){o.emit("message",c)}),this.poll.once("close",function(c,h){o.poll=null,o.emit("close",c,h),o.close()})}or(Ct,St);Ct.prototype.close=function(){St.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)};var Nn=Ct,lr=m,hr=O,jn=Nn;function ur(t){return function(e,n,s){var r={};typeof n=="string"&&(r.headers={"Content-type":"text/plain"});var i=hr.addPath(e,"/xhr_send"),o=new t("POST",i,n,r);return o.once("finish",function(c){if(o=null,c!==200&&c!==204)return s(new Error("http status "+c));s()}),function(){o.close(),o=null;var c=new Error("Aborted");c.code=1e3,s(c)}}}function kn(t,e,n,s){jn.call(this,t,e,ur(s),n,s)}lr(kn,jn);var re=kn,dr=m,Tn=_.EventEmitter;function me(t,e){Tn.call(this);var n=this;this.bufferPosition=0,this.xo=new e("POST",t,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(s,r){n._chunkHandler(s,r),n.xo=null;var i=s===200?"network":"permanent";n.emit("close",null,i),n._cleanup()})}dr(me,Tn);me.prototype._chunkHandler=function(t,e){if(!(t!==200||!e))for(var n=-1;;this.bufferPosition+=n+1){var s=e.slice(this.bufferPosition);if(n=s.indexOf(`
`),n===-1)break;var r=s.slice(0,n);r&&this.emit("message",r)}};me.prototype._cleanup=function(){this.removeAllListeners()};me.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()};var Fe=me,In=_.EventEmitter,fr=m,On=q,pr=O,de=u.XMLHttpRequest,Qe=function(){};function L(t,e,n,s){var r=this;In.call(this),setTimeout(function(){r._start(t,e,n,s)},0)}fr(L,In);L.prototype._start=function(t,e,n,s){var r=this;try{this.xhr=new de}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}e=pr.addQuery(e,"t="+ +new Date),this.unloadRef=On.unloadAdd(function(){r._cleanup(!0)});try{this.xhr.open(t,e,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){Qe("xhr timeout"),r.emit("finish",0,""),r._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!s||!s.noCredentials)&&L.supportsCORS&&(this.xhr.withCredentials=!0),s&&s.headers)for(var i in s.headers)this.xhr.setRequestHeader(i,s.headers[i]);this.xhr.onreadystatechange=function(){if(r.xhr){var o=r.xhr,c,h;switch(Qe("readyState",o.readyState),o.readyState){case 3:try{h=o.status,c=o.responseText}catch{}h===1223&&(h=204),h===200&&c&&c.length>0&&r.emit("chunk",h,c);break;case 4:h=o.status,h===1223&&(h=204),(h===12005||h===12029)&&(h=0),Qe("finish",h,o.responseText),r.emit("finish",h,o.responseText),r._cleanup(!1);break}}};try{r.xhr.send(n)}catch{r.emit("finish",0,""),r._cleanup(!1)}};L.prototype._cleanup=function(t){if(this.xhr){if(this.removeAllListeners(),On.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),t)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}};L.prototype.close=function(){this._cleanup(!0)};L.enabled=!!de;var Ft=["Active"].concat("Object").join("X");!L.enabled&&Ft in u&&(de=function(){try{return new u[Ft]("Microsoft.XMLHTTP")}catch{return null}},L.enabled=!!new de);var $n=!1;try{$n="withCredentials"in new de}catch{}L.supportsCORS=$n;var Rn=L,mr=m,Be=Rn;function Nt(t,e,n,s){Be.call(this,t,e,n,s)}mr(Nt,Be);Nt.enabled=Be.enabled&&Be.supportsCORS;var Ve=Nt,gr=m,jt=Rn;function kt(t,e,n){jt.call(this,t,e,n,{noCredentials:!0})}gr(kt,jt);kt.enabled=jt.enabled;var ge=kt,be={isOpera:function(){return u.navigator&&/opera/i.test(u.navigator.userAgent)},isKonqueror:function(){return u.navigator&&/konqueror/i.test(u.navigator.userAgent)},hasDomain:function(){if(!u.document)return!0;try{return!!u.document.domain}catch{return!1}}},br=m,An=re,vr=Fe,ft=Ve,yr=ge,_r=be;function ie(t){if(!yr.enabled&&!ft.enabled)throw new Error("Transport created when disabled");An.call(this,t,"/xhr_streaming",vr,ft)}br(ie,An);ie.enabled=function(t){return t.nullOrigin||_r.isOpera()?!1:ft.enabled};ie.transportName="xhr-streaming";ie.roundTrips=2;ie.needBody=!!u.document;var wr=ie,Un=_.EventEmitter,xr=m,Ln=q,Er=be,Sr=O,Cr=function(){};function Q(t,e,n){var s=this;Un.call(this),setTimeout(function(){s._start(t,e,n)},0)}xr(Q,Un);Q.prototype._start=function(t,e,n){var s=this,r=new u.XDomainRequest;e=Sr.addQuery(e,"t="+ +new Date),r.onerror=function(){s._error()},r.ontimeout=function(){s._error()},r.onprogress=function(){Cr("progress",r.responseText),s.emit("chunk",200,r.responseText)},r.onload=function(){s.emit("finish",200,r.responseText),s._cleanup(!1)},this.xdr=r,this.unloadRef=Ln.unloadAdd(function(){s._cleanup(!0)});try{this.xdr.open(t,e),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(n)}catch{this._error()}};Q.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)};Q.prototype._cleanup=function(t){if(this.xdr){if(this.removeAllListeners(),Ln.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,t)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}};Q.prototype.close=function(){this._cleanup(!0)};Q.enabled=!!(u.XDomainRequest&&Er.hasDomain());var Tt=Q,Nr=m,Hn=re,jr=Fe,pt=Tt;function ve(t){if(!pt.enabled)throw new Error("Transport created when disabled");Hn.call(this,t,"/xhr_streaming",jr,pt)}Nr(ve,Hn);ve.enabled=function(t){return t.cookie_needed||t.nullOrigin?!1:pt.enabled&&t.sameScheme};ve.transportName="xdr-streaming";ve.roundTrips=2;var Bn=ve,Wn=u.EventSource,kr=m,Pn=_.EventEmitter,Tr=Wn,Vt=function(){};function ye(t){Pn.call(this);var e=this,n=this.es=new Tr(t);n.onmessage=function(s){Vt("message",s.data),e.emit("message",decodeURI(s.data))},n.onerror=function(s){Vt("error",n.readyState);var r=n.readyState!==2?"network":"permanent";e._cleanup(),e._close(r)}}kr(ye,Pn);ye.prototype.abort=function(){this._cleanup(),this._close("user")};ye.prototype._cleanup=function(){var t=this.es;t&&(t.onmessage=t.onerror=null,t.close(),this.es=null)};ye.prototype._close=function(t){var e=this;setTimeout(function(){e.emit("close",null,t),e.removeAllListeners()},200)};var Ir=ye,Or=m,Mn=re,$r=Ir,Rr=Ve,Ar=Wn;function oe(t){if(!oe.enabled())throw new Error("Transport created when disabled");Mn.call(this,t,"/eventsource",$r,Rr)}Or(oe,Mn);oe.enabled=function(){return!!Ar};oe.transportName="eventsource";oe.roundTrips=2;var qt=oe,Ze,Xt;function Dn(){return Xt||(Xt=1,Ze="1.6.1"),Ze}var Ye={exports:{}},Gt;function _e(){return Gt||(Gt=1,function(t){var e=q,n=be;t.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){t.exports.WPrefix in u||(u[t.exports.WPrefix]={})},postMessage:function(s,r){u.parent!==u&&u.parent.postMessage(JSON.stringify({windowId:t.exports.currentWindowId,type:s,data:r||""}),"*")},createIframe:function(s,r){var i=u.document.createElement("iframe"),o,c,h=function(){clearTimeout(o);try{i.onload=null}catch{}i.onerror=null},d=function(){i&&(h(),setTimeout(function(){i&&i.parentNode.removeChild(i),i=null},0),e.unloadDel(c))},f=function(g){i&&(d(),r(g))},l=function(g,x){setTimeout(function(){try{i&&i.contentWindow&&i.contentWindow.postMessage(g,x)}catch{}},0)};return i.src=s,i.style.display="none",i.style.position="absolute",i.onerror=function(){f("onerror")},i.onload=function(){clearTimeout(o),o=setTimeout(function(){f("onload timeout")},2e3)},u.document.body.appendChild(i),o=setTimeout(function(){f("timeout")},15e3),c=e.unloadAdd(d),{post:l,cleanup:d,loaded:h}},createHtmlfile:function(s,r){var i=["Active"].concat("Object").join("X"),o=new u[i]("htmlfile"),c,h,d,f=function(){clearTimeout(c),d.onerror=null},l=function(){o&&(f(),e.unloadDel(h),d.parentNode.removeChild(d),d=o=null,CollectGarbage())},g=function(E){o&&(l(),r(E))},x=function(E,M){try{setTimeout(function(){d&&d.contentWindow&&d.contentWindow.postMessage(E,M)},0)}catch{}};o.open(),o.write('<html><script>document.domain="'+u.document.domain+'";<\/script></html>'),o.close(),o.parentWindow[t.exports.WPrefix]=u[t.exports.WPrefix];var v=o.createElement("div");return o.body.appendChild(v),d=o.createElement("iframe"),v.appendChild(d),d.src=s,d.onerror=function(){g("onerror")},c=setTimeout(function(){g("timeout")},15e3),h=e.unloadAdd(l),{post:x,cleanup:l,loaded:f}}},t.exports.iframeEnabled=!1,u.document&&(t.exports.iframeEnabled=(typeof u.postMessage=="function"||typeof u.postMessage=="object")&&!n.isKonqueror())}(Ye)),Ye.exports}var Ur=m,Fn=_.EventEmitter,Lr=Dn(),mt=O,Vn=_e(),qn=q,Hr=se,ae=function(){};function H(t,e,n){if(!H.enabled())throw new Error("Transport created when disabled");Fn.call(this);var s=this;this.origin=mt.getOrigin(n),this.baseUrl=n,this.transUrl=e,this.transport=t,this.windowId=Hr.string(8);var r=mt.addPath(n,"/iframe.html")+"#"+this.windowId;this.iframeObj=Vn.createIframe(r,function(i){s.emit("close",1006,"Unable to load an iframe ("+i+")"),s.close()}),this.onmessageCallback=this._message.bind(this),qn.attachEvent("message",this.onmessageCallback)}Ur(H,Fn);H.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){qn.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}};H.prototype._message=function(t){if(ae("message",t.data),!mt.isOriginEqual(t.origin,this.origin)){ae("not same origin",t.origin,this.origin);return}var e;try{e=JSON.parse(t.data)}catch{ae("bad json",t.data);return}if(e.windowId!==this.windowId){ae("mismatched window id",e.windowId,this.windowId);return}switch(e.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([Lr,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",e.data);break;case"c":var n;try{n=JSON.parse(e.data)}catch{ae("bad json",e.data);return}this.emit("close",n[0],n[1]),this.close();break}};H.prototype.postMessage=function(t,e){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:t,data:e||""}),this.origin)};H.prototype.send=function(t){this.postMessage("m",t)};H.enabled=function(){return Vn.iframeEnabled};H.transportName="iframe";H.roundTrips=2;var Xn=H,It={isObject:function(t){var e=typeof t;return e==="function"||e==="object"&&!!t},extend:function(t){if(!this.isObject(t))return t;for(var e,n,s=1,r=arguments.length;s<r;s++){e=arguments[s];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}},Br=m,Te=Xn,Wr=It,et=function(t){function e(n,s){Te.call(this,t.transportName,n,s)}return Br(e,Te),e.enabled=function(n,s){if(!u.document)return!1;var r=Wr.extend({},s);return r.sameOrigin=!0,t.enabled(r)&&Te.enabled()},e.transportName="iframe-"+t.transportName,e.needBody=!0,e.roundTrips=Te.roundTrips+t.roundTrips-1,e.facadeTransport=t,e},Pr=m,G=_e(),Mr=O,Gn=_.EventEmitter,Dr=se,Fr=function(){};function $(t){Gn.call(this);var e=this;G.polluteGlobalNamespace(),this.id="a"+Dr.string(6),t=Mr.addQuery(t,"c="+decodeURIComponent(G.WPrefix+"."+this.id)),Fr("using htmlfile",$.htmlfileEnabled);var n=$.htmlfileEnabled?G.createHtmlfile:G.createIframe;u[G.WPrefix][this.id]={start:function(){e.iframeObj.loaded()},message:function(s){e.emit("message",s)},stop:function(){e._cleanup(),e._close("network")}},this.iframeObj=n(t,function(){e._cleanup(),e._close("permanent")})}Pr($,Gn);$.prototype.abort=function(){this._cleanup(),this._close("user")};$.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete u[G.WPrefix][this.id]};$.prototype._close=function(t){this.emit("close",null,t),this.removeAllListeners()};$.htmlfileEnabled=!1;var Jt=["Active"].concat("Object").join("X");if(Jt in u)try{$.htmlfileEnabled=!!new u[Jt]("htmlfile")}catch{}$.enabled=$.htmlfileEnabled||G.iframeEnabled;var Vr=$,qr=m,gt=Vr,Xr=ge,Jn=re;function we(t){if(!gt.enabled)throw new Error("Transport created when disabled");Jn.call(this,t,"/htmlfile",gt,Xr)}qr(we,Jn);we.enabled=function(t){return gt.enabled&&t.sameOrigin};we.transportName="htmlfile";we.roundTrips=2;var zt=we,Gr=m,zn=re,Jr=Fe,bt=Ve,Kn=ge;function xe(t){if(!Kn.enabled&&!bt.enabled)throw new Error("Transport created when disabled");zn.call(this,t,"/xhr",Jr,bt)}Gr(xe,zn);xe.enabled=function(t){return t.nullOrigin?!1:Kn.enabled&&t.sameOrigin?!0:bt.enabled};xe.transportName="xhr-polling";xe.roundTrips=2;var Kt=xe,zr=m,Qn=re,Kr=Bn,Qr=Fe,Qt=Tt;function Ee(t){if(!Qt.enabled)throw new Error("Transport created when disabled");Qn.call(this,t,"/xhr",Qr,Qt)}zr(Ee,Qn);Ee.enabled=Kr.enabled;Ee.transportName="xdr-polling";Ee.roundTrips=2;var Zr=Ee,he=_e(),Zn=se,Yr=be,ei=O,ti=m,Yn=_.EventEmitter,ni=function(){};function I(t){var e=this;Yn.call(this),he.polluteGlobalNamespace(),this.id="a"+Zn.string(6);var n=ei.addQuery(t,"c="+encodeURIComponent(he.WPrefix+"."+this.id));u[he.WPrefix][this.id]=this._callback.bind(this),this._createScript(n),this.timeoutId=setTimeout(function(){e._abort(new Error("JSONP script loaded abnormally (timeout)"))},I.timeout)}ti(I,Yn);I.prototype.abort=function(){if(u[he.WPrefix][this.id]){var t=new Error("JSONP user aborted read");t.code=1e3,this._abort(t)}};I.timeout=35e3;I.scriptErrorTimeout=1e3;I.prototype._callback=function(t){this._cleanup(),!this.aborting&&(t&&this.emit("message",t),this.emit("close",null,"network"),this.removeAllListeners())};I.prototype._abort=function(t){this._cleanup(),this.aborting=!0,this.emit("close",t.code,t.message),this.removeAllListeners()};I.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete u[he.WPrefix][this.id]};I.prototype._scriptError=function(){var t=this;this.errorTimer||(this.errorTimer=setTimeout(function(){t.loadedOkay||t._abort(new Error("JSONP script loaded abnormally (onerror)"))},I.scriptErrorTimeout))};I.prototype._createScript=function(t){var e=this,n=this.script=u.document.createElement("script"),s;if(n.id="a"+Zn.string(8),n.src=t,n.type="text/javascript",n.charset="UTF-8",n.onerror=this._scriptError.bind(this),n.onload=function(){e._abort(new Error("JSONP script loaded abnormally (onload)"))},n.onreadystatechange=function(){if(ni("onreadystatechange",n.readyState),/loaded|closed/.test(n.readyState)){if(n&&n.htmlFor&&n.onclick){e.loadedOkay=!0;try{n.onclick()}catch{}}n&&e._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof n.async>"u"&&u.document.attachEvent)if(Yr.isOpera())s=this.script2=u.document.createElement("script"),s.text="try{var a = document.getElementById('"+n.id+"'); if(a)a.onerror();}catch(x){};",n.async=s.async=!1;else{try{n.htmlFor=n.id,n.event="onclick"}catch{}n.async=!0}typeof n.async<"u"&&(n.async=!0);var r=u.document.getElementsByTagName("head")[0];r.insertBefore(n,r.firstChild),s&&r.insertBefore(s,r.firstChild)};var si=I,ri=se,Zt=O,ii=function(){},j,ue;function oi(t){try{return u.document.createElement('<iframe name="'+t+'">')}catch{var e=u.document.createElement("iframe");return e.name=t,e}}function ai(){j=u.document.createElement("form"),j.style.display="none",j.style.position="absolute",j.method="POST",j.enctype="application/x-www-form-urlencoded",j.acceptCharset="UTF-8",ue=u.document.createElement("textarea"),ue.name="d",j.appendChild(ue),u.document.body.appendChild(j)}var ci=function(t,e,n){j||ai();var s="a"+ri.string(8);j.target=s,j.action=Zt.addQuery(Zt.addPath(t,"/jsonp_send"),"i="+s);var r=oi(s);r.id=s,r.style.display="none",j.appendChild(r);try{ue.value=e}catch{}j.submit();var i=function(o){r.onerror&&(r.onreadystatechange=r.onerror=r.onload=null,setTimeout(function(){r.parentNode.removeChild(r),r=null},500),ue.value="",n(o))};return r.onerror=function(){i()},r.onload=function(){i()},r.onreadystatechange=function(o){ii("onreadystatechange",s,r.readyState),r.readyState==="complete"&&i()},function(){i(new Error("Aborted"))}},li=m,es=Nn,hi=si,ui=ci;function Z(t){if(!Z.enabled())throw new Error("Transport created when disabled");es.call(this,t,"/jsonp",ui,hi)}li(Z,es);Z.enabled=function(){return!!u.document};Z.transportName="jsonp-polling";Z.roundTrips=1;Z.needBody=!0;var di=Z,fi=[Ys,wr,Bn,qt,et(qt),zt,et(zt),Kt,Zr,et(Kt),di],fe=Array.prototype,Ot=Object.prototype,pi=Function.prototype,pe=String.prototype,tt=fe.slice,$t=Ot.toString,ts=function(t){return Ot.toString.call(t)==="[object Function]"},mi=function(e){return $t.call(e)==="[object Array]"},ns=function(e){return $t.call(e)==="[object String]"},gi=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),vt;gi?vt=function(t,e,n,s){!s&&e in t||Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n})}:vt=function(t,e,n,s){!s&&e in t||(t[e]=n)};var Se=function(t,e,n){for(var s in e)Ot.hasOwnProperty.call(e,s)&&vt(t,s,e[s],n)},ss=function(t){if(t==null)throw new TypeError("can't convert "+t+" to object");return Object(t)};function bi(t){var e=+t;return e!==e?e=0:e!==0&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function vi(t){return t>>>0}function nt(){}Se(pi,{bind:function(e){var n=this;if(!ts(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var s=tt.call(arguments,1),r=function(){if(this instanceof h){var d=n.apply(this,s.concat(tt.call(arguments)));return Object(d)===d?d:this}else return n.apply(e,s.concat(tt.call(arguments)))},i=Math.max(0,n.length-s.length),o=[],c=0;c<i;c++)o.push("$"+c);var h=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this, arguments); }")(r);return n.prototype&&(nt.prototype=n.prototype,h.prototype=new nt,nt.prototype=null),h}});Se(Array,{isArray:mi});var Yt=Object("a"),rs=Yt[0]!=="a"||!(0 in Yt),yi=function(e){var n=!0,s=!0;return e&&(e.call("foo",function(r,i,o){typeof o!="object"&&(n=!1)}),e.call([1],function(){s=typeof this=="string"},"x")),!!e&&n&&s};Se(fe,{forEach:function(e){var n=ss(this),s=rs&&ns(this)?this.split(""):n,r=arguments[1],i=-1,o=s.length>>>0;if(!ts(e))throw new TypeError;for(;++i<o;)i in s&&e.call(r,s[i],i,n)}},!yi(fe.forEach));var _i=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;Se(fe,{indexOf:function(e){var n=rs&&ns(this)?this.split(""):ss(this),s=n.length>>>0;if(!s)return-1;var r=0;for(arguments.length>1&&(r=bi(arguments[1])),r=r>=0?r:Math.max(0,s+r);r<s;r++)if(r in n&&n[r]===e)return r;return-1}},_i);var en=pe.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var t=/()??/.exec("")[1]===void 0;pe.split=function(e,n){var s=this;if(e===void 0&&n===0)return[];if($t.call(e)!=="[object RegExp]")return en.call(this,e,n);var r=[],i=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),o=0,c,h,d,f;for(e=new RegExp(e.source,i+"g"),s+="",t||(c=new RegExp("^"+e.source+"$(?!\\s)",i)),n=n===void 0?-1>>>0:vi(n);(h=e.exec(s))&&(d=h.index+h[0].length,!(d>o&&(r.push(s.slice(o,h.index)),!t&&h.length>1&&h[0].replace(c,function(){for(var l=1;l<arguments.length-2;l++)arguments[l]===void 0&&(h[l]=void 0)}),h.length>1&&h.index<s.length&&fe.push.apply(r,h.slice(1)),f=h[0].length,o=d,r.length>=n)));)e.lastIndex===h.index&&e.lastIndex++;return o===s.length?(f||!e.test(""))&&r.push(""):r.push(s.slice(o)),r.length>n?r.slice(0,n):r}}():"0".split(void 0,0).length&&(pe.split=function(e,n){return e===void 0&&n===0?[]:en.call(this,e,n)});var wi=pe.substr,xi="".substr&&"0b".substr(-1)!=="b";Se(pe,{substr:function(e,n){return wi.call(this,e<0&&(e=this.length+e)<0?0:e,n)}},xi);var Ie=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,st,Ei=function(t){var e,n={},s=[];for(e=0;e<65536;e++)s.push(String.fromCharCode(e));return t.lastIndex=0,s.join("").replace(t,function(r){return n[r]="\\u"+("0000"+r.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,n},Si={quote:function(t){var e=JSON.stringify(t);return Ie.lastIndex=0,Ie.test(e)?(st||(st=Ei(Ie)),e.replace(Ie,function(n){return st[n]})):e}},rt=function(){},Ci=function(t){return{filterToEnabled:function(e,n){var s={main:[],facade:[]};return e?typeof e=="string"&&(e=[e]):e=[],t.forEach(function(r){if(r&&!(r.transportName==="websocket"&&n.websocket===!1)){if(e.length&&e.indexOf(r.transportName)===-1){rt("not in whitelist",r.transportName);return}r.enabled(n)?(rt("enabled",r.transportName),s.main.push(r),r.facadeTransport&&s.facade.push(r.facadeTransport)):rt("disabled",r.transportName)}}),s}}},yt={};["log","debug","warn"].forEach(function(t){var e;try{e=u.console&&u.console[t]&&u.console[t].apply}catch{}yt[t]=e?function(){return u.console[t].apply(u.console,arguments)}:t==="log"?function(){}:yt.log});var Ni=yt;function Y(t){this.type=t}Y.prototype.initEvent=function(t,e,n){return this.type=t,this.bubbles=e,this.cancelable=n,this.timeStamp=+new Date,this};Y.prototype.stopPropagation=function(){};Y.prototype.preventDefault=function(){};Y.CAPTURING_PHASE=1;Y.AT_TARGET=2;Y.BUBBLING_PHASE=3;var Rt=Y,is=u.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""},ji=m,os=Rt;function as(){os.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}ji(as,os);var ki=as,Ti=m,cs=Rt;function ls(t){cs.call(this),this.initEvent("message",!1,!1),this.data=t}Ti(ls,cs);var Ii=ls,hs=_.EventEmitter,Oi=m;function Ce(){var t=this;hs.call(this),this.to=setTimeout(function(){t.emit("finish",200,"{}")},Ce.timeout)}Oi(Ce,hs);Ce.prototype.close=function(){clearTimeout(this.to)};Ce.timeout=2e3;var $i=Ce,us=_.EventEmitter,Ri=m,Ai=It;function At(t,e){us.call(this);var n=this,s=+new Date;this.xo=new e("GET",t),this.xo.once("finish",function(r,i){var o,c;if(r===200){if(c=+new Date-s,i)try{o=JSON.parse(i)}catch{}Ai.isObject(o)||(o={})}n.emit("finish",o,c),n.removeAllListeners()})}Ri(At,us);At.prototype.close=function(){this.removeAllListeners(),this.xo.close()};var ds=At,Ui=m,fs=_.EventEmitter,Li=ge,Hi=ds;function qe(t){var e=this;fs.call(this),this.ir=new Hi(t,Li),this.ir.once("finish",function(n,s){e.ir=null,e.emit("message",JSON.stringify([n,s]))})}Ui(qe,fs);qe.transportName="iframe-info-receiver";qe.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()};var ps=qe,ms=_.EventEmitter,Bi=m,Wi=q,gs=Xn,Pi=ps;function Xe(t,e){var n=this;ms.call(this);var s=function(){var r=n.ifr=new gs(Pi.transportName,e,t);r.once("message",function(i){if(i){var o;try{o=JSON.parse(i)}catch{n.emit("finish"),n.close();return}var c=o[0],h=o[1];n.emit("finish",c,h)}n.close()}),r.once("close",function(){n.emit("finish"),n.close()})};u.document.body?s():Wi.attachEvent("load",s)}Bi(Xe,ms);Xe.enabled=function(){return gs.enabled()};Xe.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null};var Mi=Xe,bs=_.EventEmitter,Di=m,Fi=O,tn=Tt,nn=Ve,Vi=ge,qi=$i,sn=Mi,Oe=ds;function W(t,e){var n=this;bs.call(this),setTimeout(function(){n.doXhr(t,e)},0)}Di(W,bs);W._getReceiver=function(t,e,n){return n.sameOrigin?new Oe(e,Vi):nn.enabled?new Oe(e,nn):tn.enabled&&n.sameScheme?new Oe(e,tn):sn.enabled()?new sn(t,e):new Oe(e,qi)};W.prototype.doXhr=function(t,e){var n=this,s=Fi.addPath(t,"/info");this.xo=W._getReceiver(t,s,e),this.timeoutRef=setTimeout(function(){n._cleanup(!1),n.emit("finish")},W.timeout),this.xo.once("finish",function(r,i){n._cleanup(!0),n.emit("finish",r,i)})};W.prototype._cleanup=function(t){clearTimeout(this.timeoutRef),this.timeoutRef=null,!t&&this.xo&&this.xo.close(),this.xo=null};W.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)};W.timeout=8e3;var Xi=W,it,rn;function Gi(){if(rn)return it;rn=1;var t=_e();function e(n){this._transport=n,n.on("message",this._transportMessage.bind(this)),n.on("close",this._transportClose.bind(this))}return e.prototype._transportClose=function(n,s){t.postMessage("c",JSON.stringify([n,s]))},e.prototype._transportMessage=function(n){t.postMessage("t",n)},e.prototype._send=function(n){this._transport.send(n)},e.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},it=e,it}var ot,on;function Ji(){if(on)return ot;on=1;var t=O,e=q,n=Gi(),s=ps,r=_e(),i=is,o=function(){};return ot=function(c,h){var d={};h.forEach(function(l){l.facadeTransport&&(d[l.facadeTransport.transportName]=l.facadeTransport)}),d[s.transportName]=s;var f;c.bootstrap_iframe=function(){var l;r.currentWindowId=i.hash.slice(1);var g=function(x){if(x.source===parent&&(typeof f>"u"&&(f=x.origin),x.origin===f)){var v;try{v=JSON.parse(x.data)}catch{o("bad json",x.data);return}if(v.windowId===r.currentWindowId)switch(v.type){case"s":var E;try{E=JSON.parse(v.data)}catch{o("bad json",v.data);break}var M=E[0],ee=E[1],Ne=E[2],je=E[3];if(M!==c.version)throw new Error('Incompatible SockJS! Main site uses: "'+M+'", the iframe: "'+c.version+'".');if(!t.isOriginEqual(Ne,i.href)||!t.isOriginEqual(je,i.href))throw new Error("Can't connect to different domain from within an iframe. ("+i.href+", "+Ne+", "+je+")");l=new n(new d[ee](Ne,je));break;case"m":l._send(v.data);break;case"c":l&&l._close(),l=null;break}}};e.attachEvent("message",g),r.postMessage("s")}},ot}var zi=yn,Ki=m,an=se,Qi=Si,ce=O,Zi=q,Yi=Ci,eo=It,to=be,no=Ni,Ut=Rt,vs=_n,$e=is,so=ki,cn=Ii,ro=Xi,A=function(){},ys;function p(t,e,n){if(!(this instanceof p))return new p(t,e,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");vs.call(this),this.readyState=p.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&no.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports,this._transportOptions=n.transportOptions||{},this._timeout=n.timeout||0;var s=n.sessionId||8;if(typeof s=="function")this._generateSessionId=s;else if(typeof s=="number")this._generateSessionId=function(){return an.string(s)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=n.server||an.numberString(1e3);var r=new zi(t);if(!r.host||!r.protocol)throw new SyntaxError("The URL '"+t+"' is invalid");if(r.hash)throw new SyntaxError("The URL must not contain a fragment");if(r.protocol!=="http:"&&r.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+r.protocol+"' is not allowed.");var i=r.protocol==="https:";if($e.protocol==="https:"&&!i&&!ce.isLoopbackAddr(r.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");e?Array.isArray(e)||(e=[e]):e=[];var o=e.sort();o.forEach(function(h,d){if(!h)throw new SyntaxError("The protocols entry '"+h+"' is invalid.");if(d<o.length-1&&h===o[d+1])throw new SyntaxError("The protocols entry '"+h+"' is duplicated.")});var c=ce.getOrigin($e.href);this._origin=c?c.toLowerCase():null,r.set("pathname",r.pathname.replace(/\/+$/,"")),this.url=r.href,A("using url",this.url),this._urlInfo={nullOrigin:!to.hasDomain(),sameOrigin:ce.isOriginEqual(this.url,$e.href),sameScheme:ce.isSchemeEqual(this.url,$e.href)},this._ir=new ro(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}Ki(p,vs);function _s(t){return t===1e3||t>=3e3&&t<=4999}p.prototype.close=function(t,e){if(t&&!_s(t))throw new Error("InvalidAccessError: Invalid code");if(e&&e.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===p.CLOSING||this.readyState===p.CLOSED)){var n=!0;this._close(t||1e3,e||"Normal closure",n)}};p.prototype.send=function(t){if(typeof t!="string"&&(t=""+t),this.readyState===p.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===p.OPEN&&this._transport.send(Qi.quote(t))};p.version=Dn();p.CONNECTING=0;p.OPEN=1;p.CLOSING=2;p.CLOSED=3;p.prototype._receiveInfo=function(t,e){if(this._ir=null,!t){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(e),this._transUrl=t.base_url?t.base_url:this.url,t=eo.extend(t,this._urlInfo);var n=ys.filterToEnabled(this._transportsWhitelist,t);this._transports=n.main,A(this._transports.length+" enabled transports"),this._connect()};p.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(A("attempt",t.transportName),t.needBody&&(!u.document.body||typeof u.document.readyState<"u"&&u.document.readyState!=="complete"&&u.document.readyState!=="interactive")){this._transports.unshift(t),Zi.attachEvent("load",this._connect.bind(this));return}var e=Math.max(this._timeout,this._rto*t.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),e);var n=ce.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),s=this._transportOptions[t.transportName],r=new t(n,this._transUrl,s);r.on("message",this._transportMessage.bind(this)),r.once("close",this._transportClose.bind(this)),r.transportName=t.transportName,this._transport=r;return}this._close(2e3,"All transports failed",!1)};p.prototype._transportTimeout=function(){this.readyState===p.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))};p.prototype._transportMessage=function(t){var e=this,n=t.slice(0,1),s=t.slice(1),r;switch(n){case"o":this._open();return;case"h":this.dispatchEvent(new Ut("heartbeat")),A("heartbeat",this.transport);return}if(s)try{r=JSON.parse(s)}catch{}if(!(typeof r>"u"))switch(n){case"a":Array.isArray(r)&&r.forEach(function(i){A("message",e.transport),e.dispatchEvent(new cn(i))});break;case"m":A("message",this.transport),this.dispatchEvent(new cn(r));break;case"c":Array.isArray(r)&&r.length===2&&this._close(r[0],r[1],!0);break}};p.prototype._transportClose=function(t,e){if(A("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!_s(t)&&t!==2e3&&this.readyState===p.CONNECTING){this._connect();return}this._close(t,e)};p.prototype._open=function(){A("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===p.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=p.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new Ut("open")),A("connected",this.transport)):this._close(1006,"Server lost session")};p.prototype._close=function(t,e,n){A("_close",this.transport,t,e,n,this.readyState);var s=!1;if(this._ir&&(s=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===p.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=p.CLOSING,setTimeout((function(){this.readyState=p.CLOSED,s&&this.dispatchEvent(new Ut("error"));var r=new so;r.wasClean=n||!1,r.code=t||1e3,r.reason=e,this.dispatchEvent(r),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)};p.prototype.countRTO=function(t){return t>100?4*t:300+t};var io=function(t){return ys=Yi(t),Ji()(p,t),p},oo=fi,ao=io(oo);"_sockjs_onload"in u&&setTimeout(u._sockjs_onload,1);const _t=js(ao),le={LF:`
`,NULL:"\0"};class F{constructor(e){const{command:n,headers:s,body:r,binaryBody:i,escapeHeaderValues:o,skipContentLengthHeader:c}=e;this.command=n,this.headers=Object.assign({},s||{}),i?(this._binaryBody=i,this.isBinaryBody=!0):(this._body=r||"",this.isBinaryBody=!1),this.escapeHeaderValues=o||!1,this.skipContentLengthHeader=c||!1}get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}static fromRawFrame(e,n){const s={},r=i=>i.replace(/^\s+|\s+$/g,"");for(const i of e.headers.reverse()){i.indexOf(":");const o=r(i[0]);let c=r(i[1]);n&&e.command!=="CONNECT"&&e.command!=="CONNECTED"&&(c=F.hdrValueUnEscape(c)),s[o]=c}return new F({command:e.command,headers:s,binaryBody:e.binaryBody,escapeHeaderValues:n})}toString(){return this.serializeCmdAndHeaders()}serialize(){const e=this.serializeCmdAndHeaders();return this.isBinaryBody?F.toUnit8Array(e,this._binaryBody).buffer:e+this._body+le.NULL}serializeCmdAndHeaders(){const e=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const n of Object.keys(this.headers||{})){const s=this.headers[n];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?e.push(`${n}:${F.hdrValueEscape(`${s}`)}`):e.push(`${n}:${s}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&e.push(`content-length:${this.bodyLength()}`),e.join(le.LF)+le.LF+le.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const e=this.binaryBody;return e?e.length:0}static sizeOfUTF8(e){return e?new TextEncoder().encode(e).length:0}static toUnit8Array(e,n){const s=new TextEncoder().encode(e),r=new Uint8Array([0]),i=new Uint8Array(s.length+n.length+r.length);return i.set(s),i.set(n,s.length),i.set(r,s.length+n.length),i}static marshall(e){return new F(e).serialize()}static hdrValueEscape(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const ln=0,Re=10,Ae=13,co=58;class lo{constructor(e,n){this.onFrame=e,this.onIncomingPing=n,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(e,n=!1){let s;if(typeof e=="string"?s=this._encoder.encode(e):s=new Uint8Array(e),n&&s[s.length-1]!==0){const r=new Uint8Array(s.length+1);r.set(s,0),r[s.length]=0,s=r}for(let r=0;r<s.length;r++){const i=s[r];this._onByte(i)}}_collectFrame(e){if(e!==ln&&e!==Ae){if(e===Re){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(e)}}_collectCommand(e){if(e!==Ae){if(e===Re){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_collectHeaders(e){if(e!==Ae){if(e===Re){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(e)}}_reinjectByte(e){this._onByte(e)}_collectHeaderKey(e){if(e===co){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(e)}_collectHeaderValue(e){if(e!==Ae){if(e===Re){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_setupCollectBody(){const e=this._results.headers.filter(n=>n[0]==="content-length")[0];e?(this._bodyBytesRemaining=parseInt(e[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(e){if(e===ln){this._retrievedBody();return}this._consumeByte(e)}_collectBodyFixedSize(e){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(e)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(e){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",e)}this._initState()}_consumeByte(e){this._token.push(e)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const e=new Uint8Array(this._token);return this._token=[],e}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var B;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.OPEN=1]="OPEN",t[t.CLOSING=2]="CLOSING",t[t.CLOSED=3]="CLOSED"})(B=B||(B={}));var k;(function(t){t[t.ACTIVE=0]="ACTIVE",t[t.DEACTIVATING=1]="DEACTIVATING",t[t.INACTIVE=2]="INACTIVE"})(k=k||(k={}));class y{constructor(e){this.versions=e}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(e=>`v${e.replace(".","")}.stomp`)}}y.V1_0="1.0";y.V1_1="1.1";y.V1_2="1.2";y.default=new y([y.V1_2,y.V1_1,y.V1_0]);function ho(t,e){t.terminate=function(){const n=()=>{};this.onerror=n,this.onmessage=n,this.onopen=n;const s=new Date,r=Math.random().toString().substring(2,8),i=this.onclose;this.onclose=o=>{const c=new Date().getTime()-s.getTime();e(`Discarded socket (#${r})  closed after ${c}ms, with code/reason: ${o.code}/${o.reason}`)},this.close(),i==null||i.call(t,{code:4001,reason:`Quick discarding socket (#${r}) without waiting for the shutdown sequence.`,wasClean:!1})}}class uo{constructor(e,n,s){this._client=e,this._webSocket=n,this._connected=!1,this._serverFrameHandlers={CONNECTED:r=>{this.debug(`connected to server ${r.headers.server}`),this._connected=!0,this._connectedVersion=r.headers.version,this._connectedVersion===y.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(r.headers),this.onConnect(r)},MESSAGE:r=>{const i=r.headers.subscription,o=this._subscriptions[i]||this.onUnhandledMessage,c=r,h=this,d=this._connectedVersion===y.V1_2?c.headers.ack:c.headers["message-id"];c.ack=(f={})=>h.ack(d,i,f),c.nack=(f={})=>h.nack(d,i,f),o(c)},RECEIPT:r=>{const i=this._receiptWatchers[r.headers["receipt-id"]];i?(i(r),delete this._receiptWatchers[r.headers["receipt-id"]]):this.onUnhandledReceipt(r)},ERROR:r=>{this.onStompError(r)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=s.debug,this.stompVersions=s.stompVersions,this.connectHeaders=s.connectHeaders,this.disconnectHeaders=s.disconnectHeaders,this.heartbeatIncoming=s.heartbeatIncoming,this.heartbeatOutgoing=s.heartbeatOutgoing,this.splitLargeFrames=s.splitLargeFrames,this.maxWebSocketChunkSize=s.maxWebSocketChunkSize,this.forceBinaryWSFrames=s.forceBinaryWSFrames,this.logRawCommunication=s.logRawCommunication,this.appendMissingNULLonIncoming=s.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=s.discardWebsocketOnCommFailure,this.onConnect=s.onConnect,this.onDisconnect=s.onDisconnect,this.onStompError=s.onStompError,this.onWebSocketClose=s.onWebSocketClose,this.onWebSocketError=s.onWebSocketError,this.onUnhandledMessage=s.onUnhandledMessage,this.onUnhandledReceipt=s.onUnhandledReceipt,this.onUnhandledFrame=s.onUnhandledFrame}get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}start(){const e=new lo(n=>{const s=F.fromRawFrame(n,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${s}`),(this._serverFrameHandlers[s.command]||this.onUnhandledFrame)(s)},()=>{this.debug("<<< PONG")});this._webSocket.onmessage=n=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const s=n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data;this.debug(`<<< ${s}`)}e.parseChunk(n.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=n=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(n)},this._webSocket.onerror=n=>{this.onWebSocketError(n)},this._webSocket.onopen=()=>{const n=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),n["accept-version"]=this.stompVersions.supportedVersions(),n["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:n})}}_setupHeartbeat(e){if(e.version!==y.V1_1&&e.version!==y.V1_2||!e["heart-beat"])return;const[n,s]=e["heart-beat"].split(",").map(r=>parseInt(r,10));if(this.heartbeatOutgoing!==0&&s!==0){const r=Math.max(this.heartbeatOutgoing,s);this.debug(`send PING every ${r}ms`),this._pinger=setInterval(()=>{this._webSocket.readyState===B.OPEN&&(this._webSocket.send(le.LF),this.debug(">>> PING"))},r)}if(this.heartbeatIncoming!==0&&n!==0){const r=Math.max(this.heartbeatIncoming,n);this.debug(`check PONG every ${r}ms`),this._ponger=setInterval(()=>{const i=Date.now()-this._lastServerActivityTS;i>r*2&&(this.debug(`did not receive server activity for the last ${i}ms`),this._closeOrDiscardWebsocket())},r)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===B.CONNECTING||this._webSocket.readyState===B.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&ho(this._webSocket,e=>this.debug(e)),this._webSocket.terminate()}_transmit(e){const{command:n,headers:s,body:r,binaryBody:i,skipContentLengthHeader:o}=e,c=new F({command:n,headers:s,body:r,binaryBody:i,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:o});let h=c.serialize();if(this.logRawCommunication?this.debug(`>>> ${h}`):this.debug(`>>> ${c}`),this.forceBinaryWSFrames&&typeof h=="string"&&(h=new TextEncoder().encode(h)),typeof h!="string"||!this.splitLargeFrames)this._webSocket.send(h);else{let d=h;for(;d.length>0;){const f=d.substring(0,this.maxWebSocketChunkSize);d=d.substring(this.maxWebSocketChunkSize),this._webSocket.send(f),this.debug(`chunk sent = ${f.length}, remaining = ${d.length}`)}}}dispose(){if(this.connected)try{const e=Object.assign({},this.disconnectHeaders);e.receipt||(e.receipt=`close-${this._counter++}`),this.watchForReceipt(e.receipt,n=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(n)}),this._transmit({command:"DISCONNECT",headers:e})}catch(e){this.debug(`Ignoring error during disconnect ${e}`)}else(this._webSocket.readyState===B.CONNECTING||this._webSocket.readyState===B.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(clearInterval(this._pinger),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(e){const{destination:n,headers:s,body:r,binaryBody:i,skipContentLengthHeader:o}=e,c=Object.assign({destination:n},s);this._transmit({command:"SEND",headers:c,body:r,binaryBody:i,skipContentLengthHeader:o})}watchForReceipt(e,n){this._receiptWatchers[e]=n}subscribe(e,n,s={}){s=Object.assign({},s),s.id||(s.id=`sub-${this._counter++}`),s.destination=e,this._subscriptions[s.id]=n,this._transmit({command:"SUBSCRIBE",headers:s});const r=this;return{id:s.id,unsubscribe(i){return r.unsubscribe(s.id,i)}}}unsubscribe(e,n={}){n=Object.assign({},n),delete this._subscriptions[e],n.id=e,this._transmit({command:"UNSUBSCRIBE",headers:n})}begin(e){const n=e||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:n}});const s=this;return{id:n,commit(){s.commit(n)},abort(){s.abort(n)}}}commit(e){this._transmit({command:"COMMIT",headers:{transaction:e}})}abort(e){this._transmit({command:"ABORT",headers:{transaction:e}})}ack(e,n,s={}){s=Object.assign({},s),this._connectedVersion===y.V1_2?s.id=e:s["message-id"]=e,s.subscription=n,this._transmit({command:"ACK",headers:s})}nack(e,n,s={}){return s=Object.assign({},s),this._connectedVersion===y.V1_2?s.id=e:s["message-id"]=e,s.subscription=n,this._transmit({command:"NACK",headers:s})}}class fo{constructor(e={}){this.stompVersions=y.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this.heartbeatIncoming=1e4,this.heartbeatOutgoing=1e4,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=k.INACTIVE;const n=()=>{};this.debug=n,this.beforeConnect=n,this.onConnect=n,this.onDisconnect=n,this.onUnhandledMessage=n,this.onUnhandledReceipt=n,this.onUnhandledFrame=n,this.onStompError=n,this.onWebSocketClose=n,this.onWebSocketError=n,this.logRawCommunication=!1,this.onChangeState=n,this.connectHeaders={},this._disconnectHeaders={},this.configure(e)}get webSocket(){var e;return(e=this._stompHandler)==null?void 0:e._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(e){this._disconnectHeaders=e,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===k.ACTIVE}_changeState(e){this.state=e,this.onChangeState(e)}configure(e){Object.assign(this,e)}activate(){const e=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(k.ACTIVE),this._connect()};this.state===k.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{e()})):e()}async _connect(){if(await this.beforeConnect(),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const e=this._createWebSocket();this._stompHandler=new uo(this,e,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatOutgoing:this.heartbeatOutgoing,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:n=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(n)},onDisconnect:n=>{this.onDisconnect(n)},onStompError:n=>{this.onStompError(n)},onWebSocketClose:n=>{this._stompHandler=void 0,this.state===k.DEACTIVATING&&this._changeState(k.INACTIVE),this.onWebSocketClose(n),this.active&&this._schedule_reconnect()},onWebSocketError:n=>{this.onWebSocketError(n)},onUnhandledMessage:n=>{this.onUnhandledMessage(n)},onUnhandledReceipt:n=>{this.onUnhandledReceipt(n)},onUnhandledFrame:n=>{this.onUnhandledFrame(n)}}),this._stompHandler.start()}_createWebSocket(){let e;if(this.webSocketFactory)e=this.webSocketFactory();else if(this.brokerURL)e=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return e.binaryType="arraybuffer",e}_schedule_reconnect(){this.reconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this.reconnectDelay}ms`),this._reconnector=setTimeout(()=>{this._connect()},this.reconnectDelay))}async deactivate(e={}){var i;const n=e.force||!1,s=this.active;let r;if(this.state===k.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(k.DEACTIVATING),this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==B.CLOSED){const o=this._stompHandler.onWebSocketClose;r=new Promise((c,h)=>{this._stompHandler.onWebSocketClose=d=>{o(d),c()}})}else return this._changeState(k.INACTIVE),Promise.resolve();return n?(i=this._stompHandler)==null||i.discardWebsocket():s&&this._disposeStompHandler(),r}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(e){this._checkConnection(),this._stompHandler.publish(e)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(e,n){this._checkConnection(),this._stompHandler.watchForReceipt(e,n)}subscribe(e,n,s={}){return this._checkConnection(),this._stompHandler.subscribe(e,n,s)}unsubscribe(e,n={}){this._checkConnection(),this._stompHandler.unsubscribe(e,n)}begin(e){return this._checkConnection(),this._stompHandler.begin(e)}commit(e){this._checkConnection(),this._stompHandler.commit(e)}abort(e){this._checkConnection(),this._stompHandler.abort(e)}ack(e,n,s={}){this._checkConnection(),this._stompHandler.ack(e,n,s)}nack(e,n,s={}){this._checkConnection(),this._stompHandler.nack(e,n,s)}}class po{constructor(e){this.client=e}get outgoing(){return this.client.heartbeatOutgoing}set outgoing(e){this.client.heartbeatOutgoing=e}get incoming(){return this.client.heartbeatIncoming}set incoming(e){this.client.heartbeatIncoming=e}}class hn extends fo{constructor(e){super(),this.maxWebSocketFrameSize=16*1024,this._heartbeatInfo=new po(this),this.reconnect_delay=0,this.webSocketFactory=e,this.debug=(...n)=>{console.log(...n)}}_parseConnect(...e){let n,s,r,i={};if(e.length<2)throw new Error("Connect requires at least 2 arguments");if(typeof e[1]=="function")[i,s,r,n]=e;else switch(e.length){case 6:[i.login,i.passcode,s,r,n,i.host]=e;break;default:[i.login,i.passcode,s,r,n]=e}return[i,s,r,n]}connect(...e){const n=this._parseConnect(...e);n[0]&&(this.connectHeaders=n[0]),n[1]&&(this.onConnect=n[1]),n[2]&&(this.onStompError=n[2]),n[3]&&(this.onWebSocketClose=n[3]),super.activate()}disconnect(e,n={}){e&&(this.onDisconnect=e),this.disconnectHeaders=n,super.deactivate()}send(e,n={},s=""){n=Object.assign({},n);const r=n["content-length"]===!1;r&&delete n["content-length"],this.publish({destination:e,headers:n,body:s,skipContentLengthHeader:r})}set reconnect_delay(e){this.reconnectDelay=e}get ws(){return this.webSocket}get version(){return this.connectedVersion}get onreceive(){return this.onUnhandledMessage}set onreceive(e){this.onUnhandledMessage=e}get onreceipt(){return this.onUnhandledReceipt}set onreceipt(e){this.onUnhandledReceipt=e}get heartbeat(){return this._heartbeatInfo}set heartbeat(e){this.heartbeatIncoming=e.incoming,this.heartbeatOutgoing=e.outgoing}}class ne{static client(e,n){n==null&&(n=y.default.protocolVersions());const s=()=>{const r=ne.WebSocketClass||WebSocket;return new r(e,n)};return new hn(s)}static over(e){let n;return typeof e=="function"?n=e:(console.warn("Stomp.over did not receive a factory, auto reconnect will not work. Please see https://stomp-js.github.io/api-docs/latest/classes/Stomp.html#over"),n=()=>e),new hn(n)}}ne.WebSocketClass=null;function ws(t,e){const[n,s]=b.useState(),[r,i]=b.useState(),[o,c]=b.useState([]),[h,d]=b.useState([]),[f,l]=b.useState([]),[g,x]=b.useState(),[v,E]=b.useState(),[M,ee]=b.useState("Chats");return b.useEffect(()=>{const D=localStorage.getItem("_NOTEU_AUTH").replace(/^"(.*)"$/,"$1");at.get("http://localhost:8081/subjects/1/chats/friends",{headers:{Authorization:D}}).then(N=>{let w=[];console.log("friends response"+JSON.stringify(N.data)),N.data.forEach(S=>{const ke=S.id,X=S.email,Ge=S.profile,Je=S.tel,ze=S.membername,Ke=S.introduction;w.push({id:ke,email:X,avatar:Ge,phone:Je,name:ze,lastMessage:Ke})}),l(w)}).catch(N=>{console.error("There was an error!",N)})},[]),b.useEffect(()=>{const D=localStorage.getItem("_NOTEU_AUTH").replace(/^"(.*)"$/,"$1");at.get("http://localhost:8081/subjects/1/chats/rooms",{headers:{Authorization:D}}).then(N=>{let w=[];console.log("testetst"+JSON.stringify(N.data)),i(N.data.loginId),s(N.data.loginMemberName),N.data.chatRoomResponseDtos.forEach(S=>{const ke=S.id,X=S.participants,Ge=X[0].email,Je=X[0].id,ze=X[0].profile,Ke=X[0].tel,Ss=X[0].membername,Cs=S.lastMessage,Ns=wt(S.lastMessageDateTime);Es(ke,n),console.log("roomId : "+S.id),w.push({id:ke,email:Ge,friendId:Je,avatar:ze,phone:Ke,name:Ss,lastMessage:Cs,lastMessageOn:Ns})}),d(w),c(w),x(w[0]),console.log("rooms : "+w)}).catch(N=>{console.error("There was an error!",N)})},[]),b.useEffect(()=>{const C=new _t("http://localhost:8081/ws/chat"),D=ne.over(C);D.connect({},()=>{D.subscribe(`/topic/chats/room/${v}`,N=>{const w=JSON.parse(N.body);console.log("roomId : "+v),w.messageType!=="ENTER"&&e(S=>[...S,{roomId:w.roomId,from:{senderId:w.senderId,name:w.senderName},message:{type:"text",value:{text:w.message}},sendOn:wt(w.createdAt)}])})}),E(v),console.log("메시지를 받았어요!~~~~~~~~~")},[v]),{user:o,selectedUser:g,loginId:r,selectedGroup:M,filterUsers:C=>{ee(C),c(C!=="Chats"?[...f]:[...h]),console.log("user : "+JSON.stringify(o)),console.log("user : "+JSON.stringify(f))},search:C=>{c(C?[...h].filter(D=>D.name.toLowerCase().indexOf(C.toLowerCase())>=0):[...h])},activateUser:C=>{x(C),E(C.id),t&&t(C)},loginMemberName:n}}const mo=ks().shape({newMessage:Ts().required("Please enter your messsage")});function go(t,e){const{loginMemberName:n,loginId:s}=ws(),[r,i]=b.useState({id:s,name:n,avatar:Rs});console.log("loginMemberName :"+n),console.log("loginId :"+s);const o=b.useCallback(()=>{const d=localStorage.getItem("_NOTEU_AUTH").replace(/^"(.*)"$/,"$1");t&&at.get(`http://localhost:8081/subjects/1/chats/rooms/api?roomId=${t.id}`,{headers:{Authorization:d}}).then(f=>{let l=[];console.log(f.data),f.data.forEach(g=>{const x=wt(g.createdAt),v=g.message,E=g.roomId,M=g.senderId,ee=g.senderName;l.push({roomId:E,from:{senderId:M,name:ee},message:{type:"text",value:{text:v}},sendOn:x})}),console.log("chats : "+JSON.stringify(l)),e(l)}).catch(f=>{console.error("There was an error!",f)})},[t]);return b.useEffect(()=>{o()},[o]),{loginId:s,loginMemberName:n,toUser:r,sendChatMessage:h=>{bo(t,h.newMessage,s,n),document.getElementById("chat-form").reset()},recvChat:xs}}const xs=t=>{console.log("리비스 받은값 이거 찍여야됨 : "+JSON.stringify(t))};function bo(t,e,n,s){te.send("/app/chat/message",{},JSON.stringify({messageType:"TALK",roomId:t.id,senderId:n,senderName:s,message:e}))}function vo(t){console.log("리시브로 받은 메시지입니다. : "+JSON.stringify(t)),xs(t)}let Ue,te,un;function Es(t,e){console.log(`roomId : ${t}`),console.log(`senderName : ${e}`),console.log("소켓 연결 시작"),Ue=new _t("http://localhost:8081/ws/chat"),te=ne.over(Ue);function n(){console.log("연결 시도 중..."),Ue=new _t("/ws/chat"),te=ne.over(Ue),Es(t,e)}te.connect({},function(){setTimeout(function(){te.subscribe("/topic/chats/room/"+t,function(s){console.log("메시지를 받았어요!~~~~~~~~~");const r=JSON.parse(s.body);vo(r)}),te.send("/app/chat/message",{},JSON.stringify({messageType:"ENTER",roomId:t,senderName:e}))},1e3),un=0},function(s){un++<=5?(console.log("연결 실패"),setTimeout(n,10*1e3)):console.log("연결 재시도 횟수 초과")})}function wt(t){const e=new Date(t),n=e.getHours(),s=e.getMinutes(),r=n>=12?"pm":"am";return(n%12||12)+":"+(s<10?"0":"")+s+" "+r}function yo(){const[t,e]=b.useState();return{selectedUser:t,onUserChange:s=>{e(s)}}}const _o=({onUserSelect:t,setMessages:e})=>{const n=["Chats","Friends"],{user:s,selectedUser:r,selectedGroup:i,filterUsers:o,search:c,activateUser:h,messages:d}=ws(t,e);return a.jsx(z,{children:a.jsxs(z.Body,{className:"p-0",children:[a.jsx("ul",{className:"nav nav-tabs nav-bordered",children:n.map((f,l)=>a.jsx("li",{className:"nav-item",onClick:()=>o(f),children:a.jsx(Le,{to:"",className:ct("nav-link","py-2",{active:i===f}),children:f})},l))}),a.jsx("div",{className:"tab-content",children:a.jsxs("div",{className:"tab-pane show active card-body pb-0",children:[a.jsx("div",{className:"app-search",children:a.jsx("form",{children:a.jsxs("div",{className:"mb-2 w-100 position-relative form-group",children:[a.jsx("input",{type:"text",className:"form-control",placeholder:"People, groups & messages...",onChange:f=>c(f.target.value)}),a.jsx("span",{className:"mdi mdi-magnify search-icon"})]})})}),a.jsx(dn,{style:{maxHeight:"550px",width:"100%"},children:s.map((f,l)=>a.jsx(Le,{to:"",className:"text-body",onClick:()=>{h(f)},children:a.jsxs("div",{className:ct("d-flex","align-items-start","mt-1","p-2",{"bg-light":f.id===r.id}),children:[a.jsx("img",{src:f.avatar,className:"me-2 rounded-circle",height:"48",alt:""}),a.jsxs("div",{className:"w-100 overflow-hidden",children:[a.jsxs("h5",{className:"mt-0 mb-0 font-14",children:[a.jsx("span",{className:"float-end text-muted font-12",children:f.lastMessageOn}),f.name]}),a.jsxs("p",{className:"mt-1 mb-0 text-muted font-14",children:[a.jsx("span",{className:"w-25 float-end text-end",children:f.totalUnread&&a.jsx("span",{className:"badge badge-danger-lighten",children:f.totalUnread})}),a.jsx("span",{className:"w-75",children:f.lastMessage})]})]})]})},l))})]})})]})})},wo=({message:t,loginId:e})=>(console.log(" message 이게 무슨 값인지 확인하자 : "+JSON.stringify(t)),console.log(" loginId 이게 무슨 값인지 확인하자 : "+e),a.jsxs("li",{className:ct("clearfix",{odd:t.from.senderId===e}),children:[a.jsxs("div",{className:"chat-avatar",children:[a.jsx("img",{src:t.from.avatar,className:"rounded",alt:""}),a.jsx("i",{children:t.sendOn})]}),a.jsxs("div",{className:"conversation-text",children:[a.jsxs("div",{className:"ctext-wrap",children:[a.jsx("i",{children:t.from.name}),t.message.type==="text"&&a.jsx("p",{children:t.message.value.text})]}),t.message.type==="file"&&a.jsx(z,{className:"mt-2 mb-1 shadow-none border text-start",children:a.jsx("div",{className:"p-2",children:a.jsxs(He,{className:"align-items-center",children:[a.jsx(J,{className:"col-auto",children:a.jsx("div",{className:"avatar-sm",children:a.jsx("span",{className:"avatar-title rounded",children:a.jsx("i",{className:"uil uil-file-upload-alt font-20"})})})}),a.jsxs(J,{className:"ps-0",children:[a.jsx(Le,{to:"",className:"text-muted fw-bold",children:t.message.value.file}),a.jsx("p",{className:"mb-0",children:t.message.value.size})]}),a.jsx(J,{className:"col-auto",children:a.jsx(Le,{to:"",className:"btn btn-link btn-lg text-muted",children:a.jsx("i",{className:"ri-download-2-line"})})})]})})})]}),a.jsxs(T,{className:"conversation-actions",align:"end",children:[a.jsx(T.Toggle,{variant:"link",className:"btn btn-sm btn-link arrow-none shadow-none",children:a.jsx("i",{className:"uil uil-ellipsis-v"})}),a.jsxs(T.Menu,{children:[a.jsx(T.Item,{children:"Copy Messaget"}),a.jsx(T.Item,{children:"Edit"}),a.jsx(T.Item,{children:"Delete"})]})]})]})),xo=()=>{const t=b.useRef(null);return b.useEffect(()=>{t&&t.current&&t.current.scrollIntoView&&t.current.scrollIntoView({behavior:"smooth"})}),a.jsx("div",{ref:t})},Eo=({selectedUser:t,messages:e,setMessages:n})=>{const{loginId:s,loginMemberName:r,toUser:i,userMessages:o,sendChatMessage:c}=go(t,n);return b.useState(""),a.jsx(z,{children:a.jsxs(z.Body,{className:"position-relative px-0 pb-0",children:[a.jsx(dn,{style:{height:"538px",width:"100%"},children:a.jsxs("ul",{className:"conversation-list px-3",children:[e.map((h,d)=>a.jsx(wo,{message:h,loginId:s},d.toString())),a.jsx(xo,{})]})}),a.jsx(He,{className:"px-3 pb-3",children:a.jsx(J,{children:a.jsx("div",{className:"mt-2 bg-light p-3 rounded",children:a.jsx(Is,{name:"chat-form",id:"chat-form",onSubmit:c,schema:mo,children:a.jsxs(He,{children:[a.jsx("div",{className:"col mb-2 mb-sm-0",children:a.jsx(Os,{type:"text",name:"newMessage",className:"border-0",placeholder:"Enter your text"},"newMessage")}),a.jsx("div",{className:"col-sm-auto",children:a.jsx("div",{className:"btn-group",children:a.jsx("button",{type:"submit",className:"btn btn-success chat-send btn-block",children:a.jsx("i",{className:"uil uil-message"})})})})]})})})})})]})})},So=({selectedUser:t})=>{const e=t||{},n=e.groups?e.groups.split(","):[];return a.jsx(a.Fragment,{children:e&&a.jsx(z,{children:a.jsxs(z.Body,{children:[a.jsxs(T,{className:"float-end",align:"end",children:[a.jsx(T.Toggle,{variant:"link",className:"arrow-none card-drop p-0 shadow-none",children:a.jsx("i",{className:"mdi mdi-dots-horizontal"})}),a.jsxs(T.Menu,{children:[a.jsx(T.Item,{children:"View Full"}),a.jsx(T.Item,{children:"Edit Contact Info"}),a.jsx(T.Item,{children:"Remove"})]})]}),a.jsxs("div",{className:"mt-3 text-center",children:[a.jsx("img",{src:e.avatar,alt:"",className:"img-thumbnail avatar-lg rounded-circle"}),a.jsx("h4",{children:e.name}),a.jsxs(As,{className:"btn-sm mt-1",color:"primary",children:[a.jsx("i",{className:"uil uil-envelope-add me-1"}),"Send Email"]}),a.jsxs("p",{className:"text-muted mt-2 font-14",children:["Last Interacted: ",a.jsx("strong",{children:e.lastMessageOn})]})]}),a.jsxs("div",{className:"mt-3",children:[a.jsx("hr",{className:""}),a.jsx("p",{className:"mt-4 mb-1",children:a.jsxs("strong",{children:[a.jsx("i",{className:"uil uil-at"})," Email:"]})}),a.jsx("p",{children:e.email}),a.jsx("p",{className:"mt-3 mb-1",children:a.jsxs("strong",{children:[a.jsx("i",{className:"uil uil-phone"})," Phone Number:"]})}),a.jsx("p",{children:e.phone}),a.jsx("p",{className:"mt-3 mb-1",children:a.jsxs("strong",{children:[a.jsx("i",{className:"uil uil-location"})," Location:"]})}),a.jsx("p",{children:e.location}),a.jsx("p",{className:"mt-3 mb-1",children:a.jsxs("strong",{children:[a.jsx("i",{className:"uil uil-globe"})," Languages:"]})}),a.jsx("p",{children:e.languages}),a.jsx("p",{className:"mt-3 mb-2",children:a.jsxs("strong",{children:[a.jsx("i",{className:"uil uil-users-alt"})," Groups:"]})}),a.jsx("p",{children:n.map((s,r)=>a.jsx("span",{className:"badge badge-success-lighten p-1 font-14 me-1",children:s},r.toString()))})]})]})})})},Ao=()=>{const{selectedUser:t,onUserChange:e}=yo(),[n,s]=b.useState([]);return a.jsxs(a.Fragment,{children:[a.jsx($s,{title:"Chat",subName:"Apps"}),a.jsxs(He,{children:[a.jsx(J,{xxl:3,xl:{span:6,order:1},children:a.jsx(_o,{onUserSelect:e,setMessages:s})}),a.jsx(J,{xxl:6,xl:{span:12,order:2},children:a.jsx(Eo,{selectedUser:t,messages:n,setMessages:s})}),a.jsx(J,{xxl:{span:3,order:2},xl:{span:6,order:1},children:a.jsx(So,{selectedUser:t})})]})]})};export{Ao as default};
